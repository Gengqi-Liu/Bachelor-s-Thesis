% ======================================================================
% Chapter 5 â€” Discussion 
% ======================================================================

\section{Discussion}
\label{sec:discussion}

Chapter~4 presented the observable results obtained with the implemented
acoustic MIMO--OFDM demonstrator, including constellation diagrams, channel
impulse and frequency responses, synchronization metrics, and end-to-end
decoding performance. The results demonstrate that reliable text transmission
is achievable under practical acoustic conditions, while at the same time
revealing several non-ideal effects at the symbol and channel level.

The purpose of this chapter is not to benchmark theoretical limits, but to
interpret the observed phenomena in the context of the \emph{actual
implementation}. Each discussion point is therefore explicitly linked to
the receiver algorithms, parameter choices, and synchronization strategy
used in the system.

% ----------------------------------------------------------------------

\subsection{Reliable decoding despite dispersed constellations}
\label{sec:discussion_ber_constellation}

A first striking observation is shown in Fig.~\ref{fig:cp32_cloud_ber0}. Although the
constellation exhibits pronounced spreading and appears as a ``cloud'' rather
than compact clusters, the measured bit error rate is zero. This behavior is
not accidental, but a direct consequence of the modulation, detection, and
equalization strategy used in the demonstrator.

The system operates with uncoded 4-QAM modulation and hard-decision
nearest-neighbor demapping. As long as the equalized symbols remain within
their correct decision regions, even substantial amplitude and phase
distortion does not necessarily lead to bit errors. Consequently, BER may
remain zero even when constellation quality is clearly non-ideal.

This effect is reinforced by MMSE equalization. Unlike zero-forcing,
MMSE explicitly trades residual interference for reduced noise enhancement.
As a result, equalized symbols are not forced onto ideal constellation points,
which manifests as increased dispersion in the constellation even when the
hard decisions remain correct.

\begin{figure}[t]
    \centering
    \includegraphics[width=0.3\linewidth]{figures/ch5/sm-qam-32cp.png}
    \caption{Short cyclic prefix ($N_{\mathrm{FFT}}=128$, $N_g=32$): dispersed constellation cloud despite reliable decoding (BER $\approx 0$).}
    \label{fig:cp32_cloud_ber0}
\end{figure}

% ----------------------------------------------------------------------

\subsection{Influence of cyclic prefix length on constellation quality}
\label{sec:discussion_cp}

A clear improvement in constellation compactness is observed when the cyclic
prefix length is increased from 32 to 256 samples, as shown in
Fig.~\ref{fig:cp256_normal}. This effect is consistent with the measured
channel impulse responses: in several microphone channels, the effective
multipath tail extends beyond 32 samples. When the cyclic prefix is shorter
than the channel delay spread, residual inter-symbol interference leaks into
the FFT window, violating the circular convolution assumption of OFDM and
introducing subcarrier-dependent distortion.

With a longer cyclic prefix, the dominant part of the impulse response is
contained inside the prefix, and the OFDM demodulation assumptions are
restored. The result is a noticeably tighter constellation, even without
changing the equalizer or estimator.

\begin{figure}[t]
    \centering
    \includegraphics[width=0.3\linewidth]{figures/ch5/sm-qam-256cp.png}
    \caption{Long cyclic prefix ($N_{\mathrm{FFT}}=128$, $N_g=256$) at nominal volume: constellation clusters become significantly more compact, indicating reduced ISI.}
    \label{fig:cp256_normal}
\end{figure}

% ----------------------------------------------------------------------

\subsection{Global frame start selection and CIR structure}
\label{sec:discussion_sync_window}

Figures~\ref{fig:cir_margin10} and~\ref{fig:cir_margin0} highlight the impact of the
global frame-start selection strategy on the estimated channel impulse
responses (CIR). In the current implementation, synchronization is performed
independently on each receive channel using the Schmidl--Cox metric
(\texttt{EstFrameStart\_app}). The receiver then selects the earliest detected
peak across microphones as a \emph{global} reference start index, followed by
a fixed safety margin:
\[
i_{\text{start}}=\min_i \{\hat{i}_i\} + N_{\mathrm{FFT}} - \texttt{safetyMargin}.
\]
In the provided code, \texttt{safetyMargin = 10}. This choice favors robust
global operation: shifting slightly earlier reduces the risk that noisy peak
differences across microphones cause the FFT window to start too late and cut
into useful signal energy.

The trade-off is visible in the CIR tails. With \texttt{safetyMargin=10}
(Fig.~\ref{fig:cir_margin10}), some channels show small residual components
toward the end of the impulse response. These are consistent with window
misalignment artifacts caused by using a single global FFT window for all
microphones rather than optimizing the window per channel.

When \texttt{safetyMargin=0} (Fig.~\ref{fig:cir_margin0}), the CIR tails of
some channels appear cleaner and decay more smoothly. However, this comes with
reduced robustness against synchronization uncertainty: even small timing
errors can shift the FFT window into a less favorable region, which may
increase distortion in other runs or environments.

\begin{figure}[t]
    \centering
    \includegraphics[width=\linewidth]{figures/ch5/sm-qam-10.png}
    \caption{Estimated CIR/CTF with \texttt{safetyMargin=10}. The global windowing is robust, but small residual tail components appear in some channels.}
    \label{fig:cir_margin10}
\end{figure}

\begin{figure}[t]
    \centering
    \includegraphics[width=\linewidth]{figures/ch5/sm-qam-0.png}
    \caption{Estimated CIR/CTF with \texttt{safetyMargin=0}. CIR tails appear cleaner for some channels, but robustness against timing uncertainty is reduced.}
    \label{fig:cir_margin0}
\end{figure}

% ----------------------------------------------------------------------

\subsection{Constellation contraction at low transmit amplitude}
\label{sec:discussion_low_amp}

Figure~\ref{fig:cp256_low_amp} shows the constellation obtained when the transmit
amplitude is reduced while using a long cyclic prefix. The symbol clusters
clearly contract toward the origin.

This effect should not be attributed to carrier-frequency offset. Because
transmit and receive run on the same multi-channel audio interface, both sides
share a common hardware clock; thus, true CFO is expected to be negligible.
In this operating regime, the more plausible explanation is reduced effective
SNR combined with MMSE equalization. As the transmit amplitude is lowered, the
noise contribution becomes more dominant. The MMSE equalizer then increasingly
regularizes the inversion of the channel, resulting in an effective gain
reduction that pulls equalized symbols toward the origin.

\begin{figure}[t]
    \centering
    \includegraphics[width=0.3\linewidth]{figures/ch5/sm-qam-256-low.png}
    \caption{Low transmit amplitude ($N_{\mathrm{FFT}}=128$, $N_g=256$): constellation clusters contract toward the origin, consistent with reduced SNR and MMSE regularization.}
    \label{fig:cp256_low_amp}
\end{figure}

% ----------------------------------------------------------------------

\subsection{Engineering implications and refinement options}
\label{sec:discussion_implications}

The observed non-idealities are consistent with the implementation choices
of the demonstrator, which prioritizes robust and reproducible operation over
per-channel optimality. The results also indicate clear refinement options
that would mainly improve symbol-domain interpretability:

\begin{itemize}
    \item \textbf{Per-channel fine timing after global start:} keep the global
    start for consistency, but apply a small per-microphone timing refinement
    (within a limited search window) to maximize CIR energy concentration
    inside the cyclic prefix.
    \item \textbf{Adaptive safety margin:} replace the fixed
    \texttt{safetyMargin} by an adaptive value derived from the observed metric
    peak width or from CIR energy distribution.
    \item \textbf{Post-equalization gain normalization:} apply a stream-wise
    complex gain correction after MMSE equalization to reduce amplitude
    contraction and improve constellation comparability across runs.
\end{itemize}

These adjustments would strengthen the didactic value of constellation/CIR/CTF
visualizations while maintaining the stable end-to-end behavior demonstrated
in Chapter~4.